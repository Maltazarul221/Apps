<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Housekeeping Manager Notes</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Professional meeting notes app for housekeeping managers with voice transcription and email summaries">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HK Notes">

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üè® Housekeeping Manager Notes</h1>
            </div>
            <div class="header-right">
                <button id="manageUsersBtn" class="btn btn-icon" title="Manage Staff">
                    <span class="icon">üë•</span>
                </button>
                <button id="statsBtn" class="btn btn-icon" title="Statistics">
                    <span class="icon">üìä</span>
                </button>
                <button id="themeToggle" class="btn btn-icon" title="Toggle Dark Mode">
                    <span class="icon">üåô</span>
                </button>
                <button id="newMeetingBtn" class="btn btn-primary">+ New Session</button>
            </div>
        </header>

        <!-- Statistics Modal -->
        <div id="statsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìä Statistics</h2>
                    <button id="closeStatsBtn" class="btn-close">‚úï</button>
                </div>
                <div id="statsContent" class="stats-grid"></div>
            </div>
        </div>

        <!-- User Management Modal -->
        <div id="userModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üë• Manage Staff Members</h2>
                    <button id="closeUserModalBtn" class="btn-close">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="user-form">
                        <h3>Add New Staff Member</h3>
                        <div class="form-group">
                            <label for="userName">Name:</label>
                            <input type="text" id="userName" placeholder="e.g., Maria Garcia">
                        </div>
                        <div class="form-group">
                            <label for="userEmail">Email:</label>
                            <input type="email" id="userEmail" placeholder="e.g., maria@hotel.com">
                        </div>
                        <div class="form-group">
                            <label for="userRole">Role:</label>
                            <input type="text" id="userRole" placeholder="e.g., Room Attendant, Supervisor">
                        </div>
                        <button id="addUserBtn" class="btn btn-primary">Add Staff Member</button>
                    </div>
                    <div class="users-list">
                        <h3>Current Staff Members</h3>
                        <div id="usersContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="meetingList" class="meeting-list">
            <div class="list-header">
                <h2>Recent Meetings</h2>
                <div class="list-controls">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Search meetings and notes...">
                    </div>
                    <div class="filter-controls">
                        <select id="sortBy" class="select-input">
                            <option value="recent">Most Recent</option>
                            <option value="oldest">Oldest First</option>
                            <option value="title">Title (A-Z)</option>
                            <option value="notes">Most Notes</option>
                        </select>
                        <select id="filterBy" class="select-input">
                            <option value="all">All Sessions</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="actions">Has Action Items</option>
                            <option value="type-daily-briefing">Daily Briefings</option>
                            <option value="type-room-inspection">Room Inspections</option>
                            <option value="type-staff-training">Staff Training</option>
                            <option value="type-maintenance-review">Maintenance Reviews</option>
                            <option value="type-supply-inventory">Supply Inventory</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="meetingsContainer"></div>
        </div>

        <div id="meetingEditor" class="meeting-editor hidden">
            <div class="editor-header">
                <div class="editor-header-left">
                    <button id="backBtn" class="btn btn-secondary">‚Üê Back to List</button>
                </div>
                <div class="editor-header-right">
                    <button id="emailSummaryBtn" class="btn btn-secondary" title="Email Summary to Attendees">
                        <span class="icon">üìß</span> Email Summary
                    </button>
                    <button id="exportTxtBtn" class="btn btn-secondary" title="Export as Text">
                        <span class="icon">üìÑ</span> Export TXT
                    </button>
                    <button id="exportIcsBtn" class="btn btn-secondary" title="Export to Calendar">
                        <span class="icon">üìÖ</span> Export .ICS
                    </button>
                    <button id="importIcsBtn" class="btn btn-secondary" title="Import from Calendar">
                        <span class="icon">üì•</span> Import .ICS
                    </button>
                    <button id="deleteMeetingBtn" class="btn btn-danger">Delete Meeting</button>
                </div>
            </div>

            <div class="meeting-info">
                <input type="text" id="meetingTitle" class="input-title" placeholder="Meeting Title (e.g., Morning Briefing, Room 305 Inspection)">

                <!-- Meeting Type Selector -->
                <div class="info-item meeting-type-section">
                    <label for="meetingType">üìã Meeting Type:</label>
                    <select id="meetingType" class="select-input meeting-type-select">
                        <option value="">Select Meeting Type</option>
                        <option value="daily-briefing">Daily Briefing</option>
                        <option value="room-inspection">Room Inspection</option>
                        <option value="staff-training">Staff Training</option>
                        <option value="maintenance-review">Maintenance Review</option>
                        <option value="supply-inventory">Supply Inventory</option>
                        <option value="guest-issues">Guest Issues/Complaints</option>
                        <option value="quality-assurance">Quality Assurance</option>
                        <option value="safety-meeting">Safety Meeting</option>
                        <option value="shift-planning">Shift Planning</option>
                        <option value="department-meeting">Department Meeting</option>
                        <option value="performance-review">Performance Review</option>
                        <option value="emergency-response">Emergency Response</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="info-row">
                    <div class="info-item">
                        <label for="meetingDate">üìÖ Start Date & Time:</label>
                        <input type="datetime-local" id="meetingDate">
                    </div>
                    <div class="info-item">
                        <label for="meetingEndDate">‚è∞ End Date & Time:</label>
                        <input type="datetime-local" id="meetingEndDate">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-item">
                        <label for="meetingAttendees">üë• Staff/Attendees:</label>
                        <div class="attendees-selector">
                            <div id="selectedAttendees" class="selected-attendees"></div>
                            <div class="attendees-dropdown">
                                <button type="button" id="selectAttendeesBtn" class="btn btn-secondary select-btn">
                                    + Select Staff
                                </button>
                                <div id="attendeesDropdown" class="dropdown-menu hidden">
                                    <div class="dropdown-search">
                                        <input type="text" id="attendeeSearch" placeholder="Search staff...">
                                    </div>
                                    <div id="attendeesList" class="attendees-list-dropdown"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-item">
                        <label for="meetingLocation">üìç Location/Area:</label>
                        <input type="text" id="meetingLocation" placeholder="e.g., Floor 3, Housekeeping Office">
                    </div>
                </div>
                <div class="info-item">
                    <label for="meetingTags">üè∑Ô∏è Tags:</label>
                    <input type="text" id="meetingTags" placeholder="e.g., urgent, follow-up, maintenance">
                </div>

                <!-- Quick Templates for Housekeeping -->
                <div class="quick-templates">
                    <label>üìù Quick Templates:</label>
                    <div class="template-buttons">
                        <button type="button" class="btn btn-template" data-template="room-check">Room Checklist</button>
                        <button type="button" class="btn btn-template" data-template="supply-list">Supply List</button>
                        <button type="button" class="btn btn-template" data-template="maintenance">Maintenance Items</button>
                        <button type="button" class="btn btn-template" data-template="staff-issues">Staff Issues</button>
                    </div>
                </div>
            </div>

            <div class="notes-section">
                <h3>Notes</h3>
                <div class="note-input-container">
                    <div class="voice-controls">
                        <button id="voiceBtn" class="btn btn-voice" title="Start voice recording">
                            <span class="icon">üé§</span> Voice Input
                        </button>
                        <div id="voiceStatus" class="voice-status hidden">
                            <span class="recording-indicator"></span>
                            <span id="voiceStatusText">Listening...</span>
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoSaveNotes">
                            Auto-save voice notes
                        </label>
                    </div>
                    <textarea id="noteInput" placeholder="Type your note here or use voice input... (Ctrl/Cmd + Enter to add)" rows="3"></textarea>
                    <div class="note-actions">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isActionItem">
                            ‚ö° Mark as Action Item
                        </label>
                        <button id="addNoteBtn" class="btn btn-primary">Add Note</button>
                    </div>
                </div>
                <div id="notesContainer" class="notes-container"></div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for ICS import -->
    <input type="file" id="icsFileInput" accept=".ics" style="display: none;">

    <script src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/meeting-notes/service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;

            // Show install button or notification
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // Check if already shown
            if (localStorage.getItem('pwaInstallPromptShown')) {
                return;
            }

            // Show a subtle notification that the app can be installed
            setTimeout(() => {
                if (deferredPrompt && confirm('üì± Install Housekeeping Manager Notes on your device for easy access?\n\nYou can use it offline and access it like a native app!')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                        localStorage.setItem('pwaInstallPromptShown', 'true');
                    });
                } else {
                    localStorage.setItem('pwaInstallPromptShown', 'true');
                }
            }, 5000); // Show after 5 seconds
        }

        // Track when PWA is installed
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA was installed successfully');
        });
    </script>
</body>
</html>
